---
title: "Creating an Interactive Heatmap of GBIF Occurrences"
subtitle: "Exploring concentrations of Greater sage grouse records."
author:
  - name: Benjamin Tjepkes  
    url: //about.qmd
    orcid: 0009-0002-5524-2675
date-modified: "5/5/2023"
abstract: In this blog post, we demonstrate how to use the `rgbif` package in R to access sage grouse occurrence data from the Global Biodiversity Information Facility (GBIF) and create an interactive heatmap using Leaflet.
abstract-title: ""
categories:
  - Testing
  - R
  - Wildlife
  - Cartography
image: img-sage-grouse.jpg
---

::: {.callout-tip .intro-callout}
## Article Learning Outcomes

- Learn how to work with GBIF data within the RStudio environment.
- Learn how to use the `leaflet` package to make interactive maps. 
- Learn how to clean data using basic tidyverse verbs.

:::

## Background

### Focal Species

The Greater sage grouse (*Centrocercus urophasianus*) is a bird species native to portions of the western United States. They are important species for the ecosystems they inhabit and play a key role in controlling insect populations and serves as a food source for predators such as eagles and coyotes.

![Greater sage grouse at lek. Photo: Pat Hnilicka/USFWS](img-sage-grouse.jpg)

Sage grouse populations have declined in recent years due to habitat loss and fragmentation, leading to conservation efforts and protections being put in place to help preserve the species. Mapping where these birds have been located in recent years can show us just how much their distribution has been restricted when compared to their historic range.


### Data Sources

Today, we will pull records of sage grouse occurrences from the Global Biodiversity Information Facility. GBIF is a database of species occurrence records from sources all over the globe. `rgbif`is an r package that allows us to interface with the GBIF API. It includes functions for searching for taxonomic names, retrieving information on data providers, getting species occurrence records, getting counts of occurrence records, and using the GBIF tile map service to make rasters summarizing huge amounts of data.

## Workflow

### 1. Load Packages

Our first task is to prepare our RStudio work space by installing and/or loading the necessary packages. All of these are available through CRAN and can be installed through the `install.packages()` function.

``` r
install.packages("rgbif")   # <1>
library(rgbif)  # <1>
install.packages("leaflet") # <2>
library(leaflet) # <2>
```
1. For accessing GBIF data.
2. For mapping data interactively.


### 2. Search GBIF

Now that our packages are loaded and ready to use, we can begin the process of data import and exploration. In this case, we are looking for occurrence records for sage grouse in the United States.

``` r
grouse_info <- name_backbone("Centrocercus urophasianus") # <1>
grouse_info # <2>
```
1. This function allows us to see the taxonomic information for our focal species.
2. This prints that information to the console.

### 3. Extract Locations

As we explore our newly loaded dataframe, you will see there are two columns

``` r
wyoming_coords <- wyoming$data[, c("decimalLatitude", "decimalLongitude")]
```

### 4. Create Heatmap

``` r
leaflet(wyoming_coords) %>% 
  addTiles() %>%
  addHeatmap(lng = ~decimalLongitude,
             lat = ~decimalLatitude,
             blur = 20,
             max = 0.1)
```
